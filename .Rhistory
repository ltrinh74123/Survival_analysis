library(survminer)
library(pammtools)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
subset_columns <- c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number")
# Remove rows with missing values in the specified subset of columns
data_cleaned <- data %>%
filter(rowSums(is.na(select(., all_of(subset_columns)))) == 0)
data_cleaned = data_cleaned %>% select(c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number", "Diagnosis_name"))
obs_start = data.frame(time = 0, surv = 1, upper = 1, lower = 1)
reactiveData1 <- reactive({
validate(
need(input$age_1 != "", "Please input an age number in patient group 1"),
need(input$duration_1 != "", "Please input a disease duration at diagnosis number in patient group 1"),
need(input$ace_total_1 != "", "Please input an ACE-III total in patient group 1")
)
sex_numeric_1 <- ifelse(input$sex_1 == "Male", 1, 2)
data.frame(
obs = "Patient Group 1",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_1),
`Age at diagnosis` = input$age_1,
`Disease duration at diagnosis` = input$duration_1,
`ACEIII::ACEIIITotal` = input$ace_total_1,
diagnosis = input$diagnosis_1,
check.names = FALSE)
})
reactiveData2 <- reactive({
validate(
need(input$age_2 != "", "Please input an age number in patient group 2"),
need(input$duration_2 != "", "Please input a disease duration at diagnosis number in patient group 2"),
need(input$ace_total_2 != "", "Please input an ACE-III total in patient group 2")
)
sex_numeric_2 <- ifelse(input$sex_2 == "Male", 1, 2)
data.frame(
obs = "Patient Group 2",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_2),
`Age at diagnosis` = input$age_2,
`Disease duration at diagnosis` = input$duration_2,
`ACEIII::ACEIIITotal` = input$ace_total_2,
diagnosis = input$diagnosis_2,
check.names = FALSE)
})
#Make model for the diagnosis selected
rv_model_1 = reactive({
filter_data_1 = data_cleaned %>% filter(Diagnosis_name == reactiveData1()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_1, model = TRUE)
})
rv_model_2 = reactive({
filter_data_2 = data_cleaned %>% filter(Diagnosis_name == reactiveData2()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_2, model = TRUE)
})
#Fit the new data with the model and make a dataframe
surv_fit_1 <- reactive({
# req(rv_model_1())
fit1 <- survfit(rv_model_1(), newdata = reactiveData1()[2:5]) %>% surv_summary() %>% as.data.frame()
fit1 = bind_rows(fit1, obs_start)
fit1 = fit1%>% mutate(obs = "Patient Group 1")
})
surv_fit_2 <- reactive({
# req(rv_model_2())
fit2 <- survfit(rv_model_2(), newdata = reactiveData2()[2:5]) %>% surv_summary() %>% as.data.frame()
fit2 = bind_rows(fit2, obs_start) %>% mutate(obs = "Patient Group 2")
})
new_patients <- reactive({
new_obs <- rbind(surv_fit_1(), surv_fit_2())  # Combine the results
})
output$dataTable <- renderTable({
new_patients()
})
#| warning: false
headings <- names(significant_vars_list)
#| context: server
library(survival)
library(tidyverse)
library(survminer)
library(pammtools)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
subset_columns <- c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number")
# Remove rows with missing values in the specified subset of columns
data_cleaned <- data %>%
filter(rowSums(is.na(select(., all_of(subset_columns)))) == 0)
data_cleaned = data_cleaned %>% select(c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number", "Diagnosis_name"))
obs_start = data.frame(time = 0, surv = 1, upper = 1, lower = 1)
reactiveData1 <- reactive({
validate(
need(input$age_1 != "", "Please input an age number in patient group 1"),
need(input$duration_1 != "", "Please input a disease duration at diagnosis number in patient group 1"),
need(input$ace_total_1 != "", "Please input an ACE-III total in patient group 1")
)
sex_numeric_1 <- ifelse(input$sex_1 == "Male", 1, 2)
data.frame(
obs = "Patient Group 1",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_1),
`Age at diagnosis` = input$age_1,
`Disease duration at diagnosis` = input$duration_1,
`ACEIII::ACEIIITotal` = input$ace_total_1,
diagnosis = input$diagnosis_1,
check.names = FALSE)
})
reactiveData2 <- reactive({
validate(
need(input$age_2 != "", "Please input an age number in patient group 2"),
need(input$duration_2 != "", "Please input a disease duration at diagnosis number in patient group 2"),
need(input$ace_total_2 != "", "Please input an ACE-III total in patient group 2")
)
sex_numeric_2 <- ifelse(input$sex_2 == "Male", 1, 2)
data.frame(
obs = "Patient Group 2",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_2),
`Age at diagnosis` = input$age_2,
`Disease duration at diagnosis` = input$duration_2,
`ACEIII::ACEIIITotal` = input$ace_total_2,
diagnosis = input$diagnosis_2,
check.names = FALSE)
})
#Make model for the diagnosis selected
rv_model_1 = reactive({
filter_data_1 = data_cleaned %>% filter(Diagnosis_name == reactiveData1()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_1, model = TRUE)
})
rv_model_2 = reactive({
filter_data_2 = data_cleaned %>% filter(Diagnosis_name == reactiveData2()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_2, model = TRUE)
})
#Fit the new data with the model and make a dataframe
surv_fit_1 <- reactive({
# req(rv_model_1())
fit1 <- survfit(rv_model_1(), newdata = reactiveData1()[2:5]) %>% surv_summary() %>% as.data.frame()
fit1 = bind_rows(fit1, obs_start)
fit1 = fit1%>% mutate(obs = "Patient Group 1")
})
surv_fit_2 <- reactive({
# req(rv_model_2())
fit2 <- survfit(rv_model_2(), newdata = reactiveData2()[2:5]) %>% surv_summary() %>% as.data.frame()
fit2 = bind_rows(fit2, obs_start) %>% mutate(obs = "Patient Group 2")
})
new_patients <- reactive({
new_obs <- rbind(surv_fit_1(), surv_fit_2())  # Combine the results
})
output$dataTable <- renderTable({
new_patients()
})
#| context: server
library(survival)
library(tidyverse)
library(survminer)
library(pammtools)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
subset_columns <- c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number")
# Remove rows with missing values in the specified subset of columns
data_cleaned <- data %>%
filter(rowSums(is.na(select(., all_of(subset_columns)))) == 0)
data_cleaned = data_cleaned %>% select(c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number", "Diagnosis_name"))
obs_start = data.frame(time = 0, surv = 1, upper = 1, lower = 1)
reactiveData1 <- reactive({
validate(
need(input$age_1 != "", "Please input an age number in patient group 1"),
need(input$duration_1 != "", "Please input a disease duration at diagnosis number in patient group 1"),
need(input$ace_total_1 != "", "Please input an ACE-III total in patient group 1")
)
sex_numeric_1 <- ifelse(input$sex_1 == "Male", 1, 2)
data.frame(
obs = "Patient Group 1",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_1),
`Age at diagnosis` = input$age_1,
`Disease duration at diagnosis` = input$duration_1,
`ACEIII::ACEIIITotal` = input$ace_total_1,
diagnosis = input$diagnosis_1,
check.names = FALSE)
})
reactiveData2 <- reactive({
validate(
need(input$age_2 != "", "Please input an age number in patient group 2"),
need(input$duration_2 != "", "Please input a disease duration at diagnosis number in patient group 2"),
need(input$ace_total_2 != "", "Please input an ACE-III total in patient group 2")
)
sex_numeric_2 <- ifelse(input$sex_2 == "Male", 1, 2)
data.frame(
obs = "Patient Group 2",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_2),
`Age at diagnosis` = input$age_2,
`Disease duration at diagnosis` = input$duration_2,
`ACEIII::ACEIIITotal` = input$ace_total_2,
diagnosis = input$diagnosis_2,
check.names = FALSE)
})
#Make model for the diagnosis selected
rv_model_1 = reactive({
filter_data_1 = data_cleaned %>% filter(Diagnosis_name == reactiveData1()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_1, model = TRUE)
})
rv_model_2 = reactive({
filter_data_2 = data_cleaned %>% filter(Diagnosis_name == reactiveData2()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_2, model = TRUE)
})
#Fit the new data with the model and make a dataframe
surv_fit_1 <- reactive({
# req(rv_model_1())
fit1 <- survfit(rv_model_1(), newdata = reactiveData1()[2:5]) %>% surv_summary() %>% as.data.frame()
fit1 = bind_rows(fit1, obs_start)
fit1 = fit1%>% mutate(obs = "Patient Group 1")
})
surv_fit_2 <- reactive({
# req(rv_model_2())
fit2 <- survfit(rv_model_2(), newdata = reactiveData2()[2:5]) %>% surv_summary() %>% as.data.frame()
fit2 = bind_rows(fit2, obs_start) %>% mutate(obs = "Patient Group 2")
})
new_patients <- reactive({
new_obs <- rbind(surv_fit_1(), surv_fit_2())  # Combine the results
})
output$dataTable <- renderTable({
new_patients()
})
#| context: server
library(survival)
library(tidyverse)
library(survminer)
library(pammtools)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
subset_columns <- c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number")
# Remove rows with missing values in the specified subset of columns
data_cleaned <- data %>%
filter(rowSums(is.na(select(., all_of(subset_columns)))) == 0)
data_cleaned = data_cleaned %>% select(c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number", "Diagnosis_name"))
obs_start = data.frame(time = 0, surv = 1, upper = 1, lower = 1)
reactiveData1 <- reactive({
validate(
need(input$age_1 != "", "Please input an age number in patient group 1"),
need(input$duration_1 != "", "Please input a disease duration at diagnosis number in patient group 1"),
need(input$ace_total_1 != "", "Please input an ACE-III total in patient group 1")
)
sex_numeric_1 <- ifelse(input$sex_1 == "Male", 1, 2)
data.frame(
obs = "Patient Group 1",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_1),
`Age at diagnosis` = input$age_1,
`Disease duration at diagnosis` = input$duration_1,
`ACEIII::ACEIIITotal` = input$ace_total_1,
diagnosis = input$diagnosis_1,
check.names = FALSE)
})
reactiveData2 <- reactive({
validate(
need(input$age_2 != "", "Please input an age number in patient group 2"),
need(input$duration_2 != "", "Please input a disease duration at diagnosis number in patient group 2"),
need(input$ace_total_2 != "", "Please input an ACE-III total in patient group 2")
)
sex_numeric_2 <- ifelse(input$sex_2 == "Male", 1, 2)
data.frame(
obs = "Patient Group 2",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_2),
`Age at diagnosis` = input$age_2,
`Disease duration at diagnosis` = input$duration_2,
`ACEIII::ACEIIITotal` = input$ace_total_2,
diagnosis = input$diagnosis_2,
check.names = FALSE)
})
#Make model for the diagnosis selected
rv_model_1 = reactive({
filter_data_1 = data_cleaned %>% filter(Diagnosis_name == reactiveData1()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_1, model = TRUE)
})
rv_model_2 = reactive({
filter_data_2 = data_cleaned %>% filter(Diagnosis_name == reactiveData2()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_2, model = TRUE)
})
#Fit the new data with the model and make a dataframe
surv_fit_1 <- reactive({
# req(rv_model_1())
fit1 <- survfit(rv_model_1(), newdata = reactiveData1()[2:5]) %>% surv_summary() %>% as.data.frame()
fit1 = bind_rows(fit1, obs_start)
fit1 = fit1%>% mutate(obs = "Patient Group 1")
})
surv_fit_2 <- reactive({
# req(rv_model_2())
fit2 <- survfit(rv_model_2(), newdata = reactiveData2()[2:5]) %>% surv_summary() %>% as.data.frame()
fit2 = bind_rows(fit2, obs_start) %>% mutate(obs = "Patient Group 2")
})
new_patients <- reactive({
new_obs <- rbind(surv_fit_1(), surv_fit_2())  # Combine the results
})
output$dataTable <- renderTable({
new_patients()
})
headings
significant_vars_list
significant_vars_list
#| context: server
library(survival)
library(tidyverse)
library(survminer)
library(pammtools)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
subset_columns <- c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number")
# Remove rows with missing values in the specified subset of columns
data_cleaned <- data %>%
filter(rowSums(is.na(select(., all_of(subset_columns)))) == 0)
data_cleaned = data_cleaned %>% select(c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number", "Diagnosis_name"))
obs_start = data.frame(time = 0, surv = 1, upper = 1, lower = 1)
reactiveData1 <- reactive({
validate(
need(input$age_1 != "", "Please input an age number in patient group 1"),
need(input$duration_1 != "", "Please input a disease duration at diagnosis number in patient group 1"),
need(input$ace_total_1 != "", "Please input an ACE-III total in patient group 1")
)
sex_numeric_1 <- ifelse(input$sex_1 == "Male", 1, 2)
data.frame(
obs = "Patient Group 1",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_1),
`Age at diagnosis` = input$age_1,
`Disease duration at diagnosis` = input$duration_1,
`ACEIII::ACEIIITotal` = input$ace_total_1,
diagnosis = input$diagnosis_1,
check.names = FALSE)
})
reactiveData2 <- reactive({
validate(
need(input$age_2 != "", "Please input an age number in patient group 2"),
need(input$duration_2 != "", "Please input a disease duration at diagnosis number in patient group 2"),
need(input$ace_total_2 != "", "Please input an ACE-III total in patient group 2")
)
sex_numeric_2 <- ifelse(input$sex_2 == "Male", 1, 2)
data.frame(
obs = "Patient Group 2",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_2),
`Age at diagnosis` = input$age_2,
`Disease duration at diagnosis` = input$duration_2,
`ACEIII::ACEIIITotal` = input$ace_total_2,
diagnosis = input$diagnosis_2,
check.names = FALSE)
})
#Make model for the diagnosis selected
rv_model_1 = reactive({
filter_data_1 = data_cleaned %>% filter(Diagnosis_name == reactiveData1()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_1, model = TRUE)
})
rv_model_2 = reactive({
filter_data_2 = data_cleaned %>% filter(Diagnosis_name == reactiveData2()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_2, model = TRUE)
})
#Fit the new data with the model and make a dataframe
surv_fit_1 <- reactive({
# req(rv_model_1())
fit1 <- survfit(rv_model_1(), newdata = reactiveData1()[2:5]) %>% surv_summary() %>% as.data.frame()
fit1 = bind_rows(fit1, obs_start)
fit1 = fit1%>% mutate(obs = "Patient Group 1")
})
surv_fit_2 <- reactive({
# req(rv_model_2())
fit2 <- survfit(rv_model_2(), newdata = reactiveData2()[2:5]) %>% surv_summary() %>% as.data.frame()
fit2 = bind_rows(fit2, obs_start) %>% mutate(obs = "Patient Group 2")
})
new_patients <- reactive({
new_obs <- rbind(surv_fit_1(), surv_fit_2())  # Combine the results
})
output$dataTable <- renderTable({
new_patients()
})
significant_vars_list
#| context: server
library(survival)
library(tidyverse)
library(survminer)
library(pammtools)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
subset_columns <- c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number")
# Remove rows with missing values in the specified subset of columns
data_cleaned <- data %>%
filter(rowSums(is.na(select(., all_of(subset_columns)))) == 0)
data_cleaned = data_cleaned %>% select(c("Diagnosis till death", "Age at diagnosis", "Sex (Male 1, Female 2)", "Disease duration at diagnosis", "ACEIII::ACEIIITotal", "Diagnosis_number", "Diagnosis_name"))
obs_start = data.frame(time = 0, surv = 1, upper = 1, lower = 1)
reactiveData1 <- reactive({
validate(
need(input$age_1 != "", "Please input an age number in patient group 1"),
need(input$duration_1 != "", "Please input a disease duration at diagnosis number in patient group 1"),
need(input$ace_total_1 != "", "Please input an ACE-III total in patient group 1")
)
sex_numeric_1 <- ifelse(input$sex_1 == "Male", 1, 2)
data.frame(
obs = "Patient Group 1",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_1),
`Age at diagnosis` = input$age_1,
`Disease duration at diagnosis` = input$duration_1,
`ACEIII::ACEIIITotal` = input$ace_total_1,
diagnosis = input$diagnosis_1,
check.names = FALSE)
})
reactiveData2 <- reactive({
validate(
need(input$age_2 != "", "Please input an age number in patient group 2"),
need(input$duration_2 != "", "Please input a disease duration at diagnosis number in patient group 2"),
need(input$ace_total_2 != "", "Please input an ACE-III total in patient group 2")
)
sex_numeric_2 <- ifelse(input$sex_2 == "Male", 1, 2)
data.frame(
obs = "Patient Group 2",
`Sex (Male 1, Female 2)` = as.integer(sex_numeric_2),
`Age at diagnosis` = input$age_2,
`Disease duration at diagnosis` = input$duration_2,
`ACEIII::ACEIIITotal` = input$ace_total_2,
diagnosis = input$diagnosis_2,
check.names = FALSE)
})
#Make model for the diagnosis selected
rv_model_1 = reactive({
filter_data_1 = data_cleaned %>% filter(Diagnosis_name == reactiveData1()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_1, model = TRUE)
})
rv_model_2 = reactive({
filter_data_2 = data_cleaned %>% filter(Diagnosis_name == reactiveData2()$diagnosis)
cox_model <- coxph(Surv(`Diagnosis till death`) ~ `Age at diagnosis` + `Sex (Male 1, Female 2)` + `Disease duration at diagnosis` + `ACEIII::ACEIIITotal`, data =  filter_data_2, model = TRUE)
})
#Fit the new data with the model and make a dataframe
surv_fit_1 <- reactive({
# req(rv_model_1())
fit1 <- survfit(rv_model_1(), newdata = reactiveData1()[2:5]) %>% surv_summary() %>% as.data.frame()
fit1 = bind_rows(fit1, obs_start)
fit1 = fit1%>% mutate(obs = "Patient Group 1")
})
surv_fit_2 <- reactive({
# req(rv_model_2())
fit2 <- survfit(rv_model_2(), newdata = reactiveData2()[2:5]) %>% surv_summary() %>% as.data.frame()
fit2 = bind_rows(fit2, obs_start) %>% mutate(obs = "Patient Group 2")
})
new_patients <- reactive({
new_obs <- rbind(surv_fit_1(), surv_fit_2())  # Combine the results
})
output$dataTable <- renderTable({
new_patients()
})
library(readxl)
library(tidyverse)
library("survival")
library("survminer")
library(scales)
data = readxl::read_xlsx("240508_Survival_project_for_maths_students_opened.xlsx")
# data$`Sex (Male 1, Female 2)` = as.factor(data$`Sex (Male 1, Female 2)`)
data[data == 999.0] <- NA
data = data %>% filter(!Diagnosis_number == 2.5)
data$Diagnosis_number = as.factor(data$Diagnosis_number)
data$`CBI::PercentSleepFCorrected` = as.numeric(data$`CBI::PercentSleepFCorrected`)
data$`CBI::PercentBeliefsFCorrected` = as.numeric(data$`CBI::PercentBeliefsFCorrected`)
mapping_vector <- c("AD", "lvPPA", "bvFTD", "svPPA", "nfvPPA", "nfvPPA + Parkinson’s plus", "CBS", "PSP", "FTD-MND")
names(mapping_vector) <- c("1", "10", "2", "16", "12", "4", "3", "14", "9")
data$Diagnosis_name <- mapping_vector[as.character(data$Diagnosis_number)]
#Non numeric variables
non_numeric_vars <- names(data)[!sapply(data, is.numeric)]
#Delete non numeric variables
df <- data %>% select(-'PID', -`Diagnosis_name`, -'Diagnosis_number', -`Onset till death`, -`Original_order`, -'SummaryPrimaryDiagnosis_descriptor', -`DAD::ExportTotalIadls`,	-`DAD::ExportTotalDad`,	-`DAD::ExportTotalBadl`)
#Standarize data
data_standardized <- as.data.frame(lapply(df, rescale), check.names = FALSE)
#Combine non numeric variables
data_stand <- cbind(data$Diagnosis_name, data_standardized)
colnames(data_stand)[colnames(data_stand) == "data$Diagnosis_name"] <- "Diagnosis_name"
colnames(data_stand)[colnames(data_stand) == "data$`Sex (Male 1, Female 2)`"] <- "Sex (Male 1, Female 2)"
data_stand$`Sex (Male 1, Female 2)` = as.factor(data_stand$`Sex (Male 1, Female 2)`)
# colnames(data_stand)[colnames(data_stand) == "data$`CBI::PercentBeliefsFCorrected`"] <- "CBI::PercentBeliefsFCorrected"
# colnames(data_stand)[colnames(data_stand) == "data$`CBI::PercentSleepFCorrected`"] <- "CBI::PercentSleepFCorrected"
survreg(Surv(`Diagnosis till death`) ~., dist = "weibull", data = data_stand)
data_stand$status <- rep(1, nrow(data))
survreg(Surv(`Diagnosis till death`) ~., dist = "weibull", data = data_stand)
survreg(Surv(`Diagnosis till death`, status) ~., dist = "weibull", data = data_stand)
survreg(Surv(Diagnosis till death, status) ~., dist = "weibull", data = data_stand)
survreg(Surv(data_stand$`Diagnosis till death`, data_stand$status) ~., dist = "weibull", data = data_stand)
data_stand
surv_model <- survreg(Surv(`Diagnosis till death`, status) ~., dist = "weibull", data = data_stand)
summary(data_stand$`Diagnosis till death`)
data_stand$`Diagnosis till death`)
data_stand$`Diagnosis till death`
data$status <- rep(1, nrow(data))
surv_model <- survreg(Surv(`Diagnosis till death`, status) ~., dist = "weibull", data = data_stand)
surv_model <- survreg(Surv(`Diagnosis till death`, status) ~., dist = "weibull", data = data)
summary(surv_model)
?survreg
surv_model2 <- survreg(Surv(`Diagnosis till death`, status) ~., dist = "lognormal", data = data)
summary(surv_model2)
surv_model3 <- survreg(Surv(`Diagnosis till death`, status) ~., dist = "gamma", data = data)
